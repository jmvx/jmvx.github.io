<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<head>
<link rel="stylesheet" type="text/css" href="../stylesheet.css"/>
<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js'></script>

<link href='http://fonts.googleapis.com/css?family=Oswald:400,300,700' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Berkshire+Swash' rel='stylesheet' type='text/css'>

<title>Cafe Demo - jmv.me - Entertainment</title>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32335530-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<!-- For google calendar -->
<script type='text/javascript'>
    // from StackOverflow user "Scott",
    // http://stackoverflow.com/questions/12192491/jquery-sort-array-by-iso-8601-date
    Date.prototype.setISO8601 = function(string) {
      var regexp = "([0-9]{4})(-([0-9]{2})(-([0-9]{2})" +
      "(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?" +
      "(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";
      var d = string.match(new RegExp(regexp));
  
      var offset = 0;
      var date = new Date(d[1], 0, 1);
  
      if (d[3]) { date.setMonth(d[3] - 1); }
      if (d[5]) { date.setDate(d[5]); }
      if (d[7]) { date.setHours(d[7]); }
      if (d[8]) { date.setMinutes(d[8]); }
      if (d[10]) { date.setSeconds(d[10]); }
      if (d[12]) { date.setMilliseconds(Number("0." + d[12]) * 1000); }
      if (d[14]) {
        offset = (Number(d[16]) * 60) + Number(d[17]);
        offset *= ((d[15] == '-') ? 1 : -1);
      }
  
      offset -= date.getTimezoneOffset();
      time = (Number(date) + (offset * 60 * 1000));
      this.setTime(Number(time));
    
      return this;
    }
    
    Date.prototype.rewindToMidnight = function() {
      this.setHours(0);
      this.setMinutes(0);
      this.setSeconds(0);
      this.setMilliseconds(0);
      return this;
    }
    
    Date.prototype.addDays = function(days) {
      this.setTime(this.getTime() + days * 24 * 60 * 60 * 1000);
      return this;
    }
    
    Date.prototype.fallsOnDay = function(d) {
      // Get midnight of both dates, are they the same?
      var dMidnight = new Date(d).rewindToMidnight();
      var tMidnight = new Date(this).rewindToMidnight();
      return (dMidnight.getTime() == tMidnight.getTime());
    }
    
    Date.prototype.fallsBetweenDates = function(start, end) {
      return (this >= start && this <= end);
    }
    
    Date.prototype.toJuliaString = function() {
      var str = "";
      
      str += [ "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday" ][this.getDay()];
      str += ", ";
      str += [ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" ][this.getMonth()];
      str += " ";
      str += this.getDate().toString();
      str += ", ";
      str += this.getFullYear().toString();
      
      var isMidnight = (this.getHours() == 0 && this.getMinutes() == 0);
      var isNoon = (this.getHours() == 12 && this.getMinutes() == 0);
      var isNoonOrMidnight = (isMidnight || isNoon);
      var isAM = (this.getHours() < 12);
      
      str += " at ";
      if (isMidnight)
        str += "midnight"
      else if (isNoon)
        str += "noon"
      else
        str += (this.getHours() % 12).toString();
      
      if (this.getMinutes() > 0)
      {
        var paddedMins = (this.getMinutes() + 100).toString().slice(-2);
        str += ":" + paddedMins;
      }
      
      if (!isNoonOrMidnight)
        str += " " + (isAM ? "AM" : "PM");
      
      return str;
    }

    function GCalEvents() {
      var calendar_json_url = "https://www.google.com/calendar/feeds/3t527mprvvj74ppulcjvfd1448%40group.calendar.google.com/public/full?alt=json"
      // get list of upcoming events
      $.getJSON(calendar_json_url, function(data) {
        // Distill events down to the information we care about
        var events = new Array();
        $.each(data.feed.entry, function(i, item) {
          console.log(item);
          var ev = {};
          ev.title = item.title.$t;
          ev.content = item.content.$t;
          ev.date = (new Date()).setISO8601(item.gd$when[0].startTime);
          events.push(ev);
        });
      
        // Sort events by date, ascending
        events.sort(function (a, b) {
          return b.date < a.date ? 1 : -1;
        });
      
        // Date objects representing our range
        var today = new Date().rewindToMidnight();
        var lastday = new Date(today).addDays(7);
        
        // Filter to just events within our range
        var upcoming = $.grep(events, function(event, i) {
          return event.date.fallsBetweenDates(today, lastday);
        });
      
        // Output
        $.each(upcoming, function(i, event) {
          var el_title = $("<div>");
          el_title.addClass("event-title");
          el_title.text(event.title);
          
          var el_date = $("<div>");
          el_date.addClass("event-date");
          el_date.text(event.date.toJuliaString());
          
          var el_content = $("<div>");
          el_content.addClass("event-content");
          el_content.text(event.content);
          
          var el = $("<div>").append(el_title)
                             .append(el_date)
                             .append(el_content);
          el.addClass("event");
          $("#gcal-events").append(el);
        });
      });
    }
  </script>

</head>

<body>
	
	<div id="container">
		
		<div id="header">
			<div id="title">Cafe Julia</div>
			<div id="subtitle">I love coffee.</div>
			<div id="navigation">
				<ul>
					<li><a href="http://jmv.me/demos/cafe/">Home</a></li>
					<li><a href="http://jmv.me/demos/cafe/menu/">Menu</a></li>
					<li><a href="http://jmv.me/demos/cafe/about/">About</a></li>
					<li><a href="http://jmv.me/demos/cafe/entertainment/">Entertainment</a></li>
				</ul>
			</div>
		</div>
		
		<div id="content">
		<div class="side-image"><img src="../images/entertainment-2.jpg" /></div>
    <h2>Upcoming Events</h2>
    
    <div class="scroll">
      <div id="gcal-events"></div>
    </div>
      
      <script type="text/javascript" charset="utf-8">
        $(document).ready(GCalEvents());
      </script>
      
		</div>
	
  
		<div class="info">
			<div class="contactinfo">
			111 Penny Lane<br />
      San Jose, CA 31415
			(555) 123 &ndash; 4567
			</div>
			
			<div class="hours">
			<ul>
				<li>Monday &ndash; Friday: 3 am &ndash; 1 pm</li>
				<li>Saturday: 1 am &ndash; 4 pm</li>
				<li>Sunday: 1 am &ndash; 5 pm</li>
			</ul>
			</div>
		</div>

</body>

</html>